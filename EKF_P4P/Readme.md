本程序仿真低速无人车在布满二维码的环境中运行定位情况.
为了便于找到二维码,在平行于小车移动方向上一定距离平面上按照条形码的大小设置路标点,作为条形码顶点,每次都只选取其中的四点作为路标点,且保证任何三点均不共线.

程序思路如下:
小车按真实速度和方位角运动,只能观测到带有噪声的小车运动本体线速度和旋转速度,以及带有一定误差的初始位置和方位角,并假设速度的观测方差已知;
每行进一步,得到通过观测速度得到含误差的位置,并查看是否观测到4个路标点,如果没有则继续运动,将观测位置和方差作为下一步运动的初始信息;若观察到4个路标点,
通过相机成像模型和相机实际位姿(可通过小车位置和方位角算出,并认为roll和pitch均为0)可以得到理论(也就是实际像素点)像素坐标,给每个理论坐标施加高斯噪声得到观测坐标,用观测到的4个坐标计算的到相机的位姿,然后给每个坐标施加上述高斯标准差的干扰,再计算位姿,得到一系列的位姿,求出对应的一系列相机位置和方向角,利用这一系列数据与观测坐标得到的数据计算得到相应的方差,如此就得到两个小车的位置观测信息及方差:轮速计和相机,融合计算得到更新后的位置及方差;


初步结论:  (对象素的的)
观测距离1m左右,条形码高0.02m,宽0.05m.
1,当相机观测标准差设为1时,初始时刻观测到的像素误差很小,但计算的方位偏差较大,之后会逐渐靠拢真实轨迹:
实际像素位置 -------观测像素位置 
  [269, 464]-------[268, 462]
  [269, 382]-------[269, 380]
  [243, 465]-------[243, 465]
  [243, 383]-------[243, 382]
实际旋转矩阵
[-0.059680071, -0.99821758, 4.3633477e-08;
 0, -4.3711388e-08, -1;
 0.99821758, -0.059680071, 2.6086988e-09]
相机计算得到的旋转矩阵
[-0.26327458, -0.96409005, 0.03488303;
 -0.22231843, 0.025446093, -0.97464198;
 0.93875504, -0.2643536, -0.22103429]
相机欧拉角
[-1.57075, 1.219, 0]  此处主要观测第二个数值,也就是偏航角,正确的值是1.57075(90度)
相机计算得到的位置:
x:0.19133 y:0.147975 yaw-20.1565
实际位置:
x:-0.0163742 y:-0.0388066 yaw:3.42145

之后的几次观测结果也显示,观测误差对欧拉角影响很大,运行轨迹也符合这个结果.

2,当相机观测标准差设为大于2时,误差明显增大,定位已经无法进行:
实际像素点 ------ 观测像素点
[269, 464]-------[268, 461]
[269, 382]-------[270, 379]
[243, 465]-------[243, 466]
[243, 383]-------[243, 381]
实际旋转矩阵
[-0.059680071, -0.99821758, 4.3633477e-08;
 0, -4.3711388e-08, -1;
 0.99821758, -0.059680071, 2.6086988e-09]
相机的旋转矩阵
[-0.58469659, -0.80747652, 0.078176036;
 -0.34117779, 0.15732552, -0.92673963;
 0.73602146, -0.56853348, -0.36748075]
欧拉角
[-1.57075, 0.827174, 0]
相机计算得到的位置:
x:0.438891y:0.362453yaw-42.6064
实际位置:
x:-0.0163742y:-0.0388066yaw:3.42145

观测偏差都在2个像素内,但计算的得到的偏差已经很大了.

3,当相机观测标准差设为0时,也就是相机测量的是真实值,利用opencv里PNP算法得到的位置信息与实际值有偏差,这应该是算法的问题,后期可以考虑利用优化来求PNP问题.
真实像素坐标----  观测坐标
[269, 464]-------[269, 464]
[269, 382]-------[269, 382]
[243, 465]-------[243, 465]
[243, 383]-------[243, 383]
实际旋转矩阵
[-0.059680071, -0.99821758, 4.3633477e-08;
 0, -4.3711388e-08, -1;
 0.99821758, -0.059680071, 2.6086988e-09]
相机的旋转矩阵
[7.2514217e-13, -0.99999398, -0.0034678678;
 1.637579e-12, 0.0034678678, -0.99999398;
 1, 7.1936901e-13, 1.640077e-12]
欧拉角
[-1.57075, 1.5708, 0]
相机计算得到的位置:
x:-0.000968765y:-0.100072yaw2.65626e-06
实际位置:
x:-0.0163742y:-0.0388066yaw:3.42145
可以看到yaw有一定的偏差,有可能是算法本身的系统误差问题;
